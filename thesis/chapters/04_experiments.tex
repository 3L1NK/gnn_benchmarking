This chapter defines the executable experiment protocol used to produce all thesis artifacts.

\section{Execution Workflow}
The repository supports single-run debugging and full matrix orchestration under the same interface.

\begin{verbatim}
# Single run
python train.py --config configs/runs/core/gcn_corr_only.yaml

# Canonical tuned-all matrix
python scripts/run_all_models_tuned_matrix.py --fresh-results --with-report --budget medium

# One-command report/table/PDF refresh
python scripts/build_thesis_report.py --build-pdf
\end{verbatim}

The tuned matrix writes its ledger to \texttt{results/results\_tuned\_all.jsonl}. Report artifacts are exported to \texttt{results/reports/thesis\_tuned\_all/}.

\section{Run Matrix Definition}
The tuned benchmark matrix contains 14 model variants and two rebalance policies (1 and 5), yielding 28 canonical rows after deduplication by stable run key.

Model variants:
\begin{itemize}
  \item \textbf{Non-graph}: \texttt{xgb\_raw}, \texttt{lstm}
  \item \textbf{Graph-feature}: \texttt{xgb\_node2vec\_corr}, \texttt{graphlasso\_linear}
  \item \textbf{Static GNN}: GCN/GAT with \texttt{corr}, \texttt{sector}, \texttt{granger}, \texttt{corr+sector+granger}
  \item \textbf{Static temporal-labeled}: \texttt{tgcn\_static\_corr\_only}, \texttt{tgat\_static\_corr\_only}
\end{itemize}

\section{Stable Run Identity and Deduplication}
Each run row records additive identity fields:
\begin{itemize}
  \item \texttt{split\_id}: hash of protocol/split fields,
  \item \texttt{config\_hash}: hash of normalized modeling config,
  \item \texttt{run\_key}: hash over model identity, split identity, and config hash.
\end{itemize}
Ledger writing uses upsert-by-\texttt{run\_key}; latest timestamp wins. This prevents historical reruns from appearing as duplicate models in thesis tables.

\section{Artifact Interface}
The thesis consumes generated CSV and PNG artifacts only; no table values are entered manually.
\begin{itemize}
  \item \texttt{master\_comparison.csv}: canonical deduplicated run-level table
  \item \texttt{master\_comparison\_raw.csv}: pre-dedup audit trace
  \item \texttt{run\_matrix.csv}: explicit coverage and identity table
  \item \texttt{family\_summary.csv}: best run per family/category and rebalance policy
  \item \texttt{edge\_ablation\_summary.csv}: GNN edge-type aggregate diagnostics
  \item \texttt{decision\_ranking.csv}: deterministic deployment ranking
  \item \texttt{baseline\_context.csv}: global vs test-window buy-and-hold context
  \item \texttt{baseline\_policy\_comparison.csv}: baseline benchmark metrics (\textit{Buy and hold (fixed shares)}, \textit{Equal weight (rebalanced, all assets)})
\end{itemize}

\section{Canonical Run Matrix Table}
\Cref{tab:run-matrix} is auto-generated from \texttt{run\_matrix.csv}. It is the source-of-truth coverage table for Chapter~5.
\input{tables/generated/run_matrix.tex}

\section{Hardware and Runtime Reporting}
Training supports CUDA and CPU execution through one config schema. In the produced ledger, runtime is recorded as
\texttt{runtime\_train\_seconds} and \texttt{runtime\_inference\_seconds} per run-policy row, enabling reproducibility checks across reruns and hardware environments.

\section{Quality Controls and Fail-Fast Checks}
The pipeline enforces:
\begin{itemize}
  \item protocol guard checks in \texttt{train.py},
  \item prediction artifact audits for duplicate \texttt{(date,ticker)} rows,
  \item no-NaN guards on thesis-critical metrics,
  \item plot point-count sanity checks per rebalance policy,
  \item expected run-matrix size checks (28 rows for tuned-all).
\end{itemize}
If any check fails, report generation stops instead of producing partially valid thesis artifacts.

\section{Reproducibility Contract}
The reproducibility contract for this thesis is:
\begin{enumerate}
  \item fixed protocol settings in canonical configs,
  \item deterministic run metadata and dedup logic,
  \item single-source report generation from tuned-all ledger,
  \item automatic LaTeX table export from report CSVs,
  \item one-command end-to-end rebuild of report and PDF.
\end{enumerate}

This contract is designed so that rerunning the same commands with the same seeds and data yields the same matrix coverage and consistent thesis-level conclusions.
